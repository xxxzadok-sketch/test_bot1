# fix_categories.py
from database import Database


def fix_menu_categories():
    """–ò—Å–ø—Ä–∞–≤–∏—Ç—å –∫–∞—Ç–µ–≥–æ—Ä–∏–∏ –¥–ª—è –ø–æ–∑–∏—Ü–∏–π –º–µ–Ω—é"""
    db = Database()
    cursor = db.conn.cursor()

    print("üîÑ –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∫–∞—Ç–µ–≥–æ—Ä–∏–π –≤ –º–µ–Ω—é...")

    # –°–ø–∏—Å–æ–∫ –ø–æ–∑–∏—Ü–∏–π –¥–ª—è –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è
    corrections = [
        ("–°–º–æ—Ä–æ–¥–∏–Ω–æ–≤—ã–π", "–ß–∞–π"),
        ("–ö–ª—É–±–Ω–∏—á–Ω—ã–π", "–ß–∞–π"),
        ("–ú–∞—Ä–æ–∫–∫–∞–Ω—Å–∫–∏–π", "–ß–∞–π"),
        ("–ì–æ–ª—É–±–∏–∫–∞", "–ß–∞–π"),
        ("–ü–∏–≤–æ/–≠–Ω–µ—Ä–≥–µ—Ç–∏–∫", "–ù–∞–ø–∏—Ç–∫–∏")
    ]

    fixed_count = 0
    for item_name, correct_category in corrections:
        try:
            # –ü—Ä–æ–≤–µ—Ä—è–µ–º —Ç–µ–∫—É—â—É—é –∫–∞—Ç–µ–≥–æ—Ä–∏—é
            cursor.execute('SELECT category FROM menu_items WHERE name = ?', (item_name,))
            result = cursor.fetchone()

            if result:
                current_category = result[0]
                if current_category != correct_category:
                    cursor.execute(
                        'UPDATE menu_items SET category = ? WHERE name = ?',
                        (correct_category, item_name)
                    )
                    print(f"‚úÖ –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–æ: {item_name} - –±—ã–ª–æ '{current_category}', —Å—Ç–∞–ª–æ '{correct_category}'")
                    fixed_count += 1
                else:
                    print(f"‚úÖ –£–∂–µ –ø—Ä–∞–≤–∏–ª—å–Ω–æ: {item_name} - '{correct_category}'")
            else:
                print(f"‚ùå –ü–æ–∑–∏—Ü–∏—è –Ω–µ –Ω–∞–π–¥–µ–Ω–∞: {item_name}")

        except Exception as e:
            print(f"‚ùå –û—à–∏–±–∫–∞ —Å {item_name}: {e}")

    db.conn.commit()
    print(f"\nüéØ –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–æ {fixed_count} –ø–æ–∑–∏—Ü–∏–π")


def check_current_categories():
    """–ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Ç–µ–∫—É—â–∏–µ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏ –ø—Ä–æ–±–ª–µ–º–Ω—ã—Ö –ø–æ–∑–∏—Ü–∏–π"""
    db = Database()
    cursor = db.conn.cursor()

    print("\nüîç –¢–µ–∫—É—â–∏–µ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏ –ø—Ä–æ–±–ª–µ–º–Ω—ã—Ö –ø–æ–∑–∏—Ü–∏–π:")
    print("=" * 50)

    problem_items = ["–°–º–æ—Ä–æ–¥–∏–Ω–æ–≤—ã–π", "–ö–ª—É–±–Ω–∏—á–Ω—ã–π", "–ú–∞—Ä–æ–∫–∫–∞–Ω—Å–∫–∏–π", "–ì–æ–ª—É–±–∏–∫–∞", "–ü–∏–≤–æ/–≠–Ω–µ—Ä–≥–µ—Ç–∏–∫"]

    for item_name in problem_items:
        cursor.execute('SELECT name, category FROM menu_items WHERE name = ?', (item_name,))
        result = cursor.fetchone()
        if result:
            name, category = result
            print(f"  {name}: '{category}'")
        else:
            print(f"  {item_name}: ‚ùå –ù–ï –ù–ê–ô–î–ï–ù")


def repopulate_menu_completely():
    """–ü–æ–ª–Ω–æ—Å—Ç—å—é –ø–µ—Ä–µ–∑–∞–ø–æ–ª–Ω–∏—Ç—å –º–µ–Ω—é —Å –ø—Ä–∞–≤–∏–ª—å–Ω—ã–º–∏ –∫–∞—Ç–µ–≥–æ—Ä–∏—è–º–∏"""
    db = Database()
    cursor = db.conn.cursor()

    print("üîÑ –ü–æ–ª–Ω–æ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ –º–µ–Ω—é —Å –ø—Ä–∞–≤–∏–ª—å–Ω—ã–º–∏ –∫–∞—Ç–µ–≥–æ—Ä–∏—è–º–∏...")

    # –û—á–∏—â–∞–µ–º —Ç–∞–±–ª–∏—Ü—É
    cursor.execute('DELETE FROM menu_items')
    print("‚úÖ –¢–∞–±–ª–∏—Ü–∞ –æ—á–∏—â–µ–Ω–∞")

    # –í—Å–µ –ø–æ–∑–∏—Ü–∏–∏ –º–µ–Ω—é —Å –ü–†–ê–í–ò–õ–¨–ù–´–ú–ò –∫–∞—Ç–µ–≥–æ—Ä–∏—è–º–∏
    all_menu_items = [
        # –ö–∞–ª—å—è–Ω—ã
        ('–ü–µ–Ω—Å–∏–æ–Ω–Ω—ã–π', 800, '–ö–∞–ª—å—è–Ω—ã'),
        ('–°—Ç–∞–Ω–¥–∞—Ä—Ç', 1000, '–ö–∞–ª—å—è–Ω—ã'),
        ('–ü—Ä–µ–º–∏—É–º', 1200, '–ö–∞–ª—å—è–Ω—ã'),
        ('–§—Ä—É–∫—Ç–æ–≤–∞—è —á–∞—à–∞', 1500, '–ö–∞–ª—å—è–Ω—ã'),
        ('–°–∏–≥–∞—Ä–Ω—ã–π', 1500, '–ö–∞–ª—å—è–Ω—ã'),
        ('–ü–∞—Ä—Ñ—é–º', 2000, '–ö–∞–ª—å—è–Ω—ã'),

        # –ù–∞–ø–∏—Ç–∫–∏
        ('–í–æ–¥–∞', 100, '–ù–∞–ø–∏—Ç–∫–∏'),
        ('–ö–æ–ª–∞ 0,5–ª', 100, '–ù–∞–ø–∏—Ç–∫–∏'),
        ('–ö–æ–ª–∞/–§–∞–Ω—Ç–∞/–°–ø—Ä–∞–π—Ç 1–ª', 200, '–ù–∞–ø–∏—Ç–∫–∏'),
        ('–ü–∏–≤–æ/–≠–Ω–µ—Ä–≥–µ—Ç–∏–∫', 200, '–ù–∞–ø–∏—Ç–∫–∏'),  # –ü–†–ê–í–ò–õ–¨–ù–ê–Ø –∫–∞—Ç–µ–≥–æ—Ä–∏—è

        # –ö–æ–∫—Ç–µ–π–ª–∏
        ('–í/–∫–æ–ª–∞', 400, '–ö–æ–∫—Ç–µ–π–ª–∏'),
        ('–°–∞–Ω—Ä–∞–π–∑', 400, '–ö–æ–∫—Ç–µ–π–ª–∏'),
        ('–õ–∞–≥—É–Ω–∞', 400, '–ö–æ–∫—Ç–µ–π–ª–∏'),
        ('–§–∏–µ—Ä–æ', 400, '–ö–æ–∫—Ç–µ–π–ª–∏'),
        ('–ü—Ä–æ–±–∏—Ä–∫–∏', 600, '–ö–æ–∫—Ç–µ–π–ª–∏'),

        # –ß–∞–π
        ("–î–∞ –•—É–Ω –ü–∞–æ", 400, "–ß–∞–π"),
        ("–¢–µ –ì—É–∞–Ω—å –ò–Ω—å", 400, "–ß–∞–π"),
        ("–®—É –ø—É—ç—Ä", 400, "–ß–∞–π"),
        ("–°—è–æ –ß–∂—É–Ω", 400, "–ß–∞–π"),
        ("–Æ—ç –ì—É–∞–Ω –ë–∞–π", 400, "–ß–∞–π"),
        ("–ì–∞–±–∞", 400, "–ß–∞–π"),
        ("–ì—Ä–µ—á–∏—à–Ω—ã–π", 400, "–ß–∞–π"),
        ("–ú–µ–¥–æ–≤–∞—è –¥—ã–Ω—è", 400, "–ß–∞–π"),
        ("–ú–∞–ª–∏–Ω–∞/–ú—è—Ç–∞", 400, "–ß–∞–π"),
        ("–ù–∞–≥–ª—ã–π —Ñ—Ä—É–∫—Ç", 400, "–ß–∞–π"),
        ("–í–∏—à–Ω–µ–≤—ã–π –ø—É—ç—Ä", 500, "–ß–∞–π"),
        ("–ú–∞—Ä–æ–∫–∫–∞–Ω—Å–∫–∏–π", 500, "–ß–∞–π"),  # –ü–†–ê–í–ò–õ–¨–ù–ê–Ø –∫–∞—Ç–µ–≥–æ—Ä–∏—è
        ("–ì–æ–ª—É–±–∏–∫–∞", 500, "–ß–∞–π"),  # –ü–†–ê–í–ò–õ–¨–ù–ê–Ø –∫–∞—Ç–µ–≥–æ—Ä–∏—è
        ("–°–º–æ—Ä–æ–¥–∏–Ω–æ–≤—ã–π", 500, "–ß–∞–π"),  # –ü–†–ê–í–ò–õ–¨–ù–ê–Ø –∫–∞—Ç–µ–≥–æ—Ä–∏—è
        ("–ö–ª—É–±–Ω–∏—á–Ω—ã–π", 500, "–ß–∞–π"),  # –ü–†–ê–í–ò–õ–¨–ù–ê–Ø –∫–∞—Ç–µ–≥–æ—Ä–∏—è
        ("–û–±–ª–µ–ø–∏—Ö–æ–≤—ã–π", 500, "–ß–∞–π")
    ]

    # –î–æ–±–∞–≤–ª—è–µ–º –≤—Å–µ –ø–æ–∑–∏—Ü–∏–∏
    for name, price, category in all_menu_items:
        try:
            cursor.execute(
                'INSERT INTO menu_items (name, price, category) VALUES (?, ?, ?)',
                (name, price, category)
            )
            print(f"‚úÖ –î–æ–±–∞–≤–ª–µ–Ω–æ: {name} - {price}‚ÇΩ ({category})")
        except Exception as e:
            print(f"‚ùå –û—à–∏–±–∫–∞ —Å {name}: {e}")

    db.conn.commit()
    print(f"‚úÖ –î–æ–±–∞–≤–ª–µ–Ω–æ {len(all_menu_items)} –ø–æ–∑–∏—Ü–∏–π –≤ –º–µ–Ω—é")


if __name__ == "__main__":
    print("–í—ã–±–µ—Ä–∏—Ç–µ –¥–µ–π—Å—Ç–≤–∏–µ:")
    print("1 - –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Ç–µ–∫—É—â–∏–µ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏")
    print("2 - –ò—Å–ø—Ä–∞–≤–∏—Ç—å —Ç–æ–ª—å–∫–æ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏ –ø—Ä–æ–±–ª–µ–º–Ω—ã—Ö –ø–æ–∑–∏—Ü–∏–π")
    print("3 - –ü–æ–ª–Ω–æ—Å—Ç—å—é –ø–µ—Ä–µ–∑–∞–ø–æ–ª–Ω–∏—Ç—å –º–µ–Ω—é (—Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è)")

    choice = input("–í–≤–µ–¥–∏—Ç–µ 1, 2 –∏–ª–∏ 3: ")

    if choice == "1":
        check_current_categories()
    elif choice == "2":
        fix_menu_categories()
    elif choice == "3":
        repopulate_menu_completely()
    else:
        print("‚ùå –ù–µ–≤–µ—Ä–Ω—ã–π –≤—ã–±–æ—Ä")